<!DOCTYPE html>
<html>
  <head>
    <!--
                  _     _                        _                 _ 
         /\      | |   | |                      | |               | |
        /  \   __| | __| |_ __ ___  ___ ___  ___| | ___  _   _  __| |
       / /\ \ / _` |/ _` | '__/ _ \/ __/ __|/ __| |/ _ \| | | |/ _` |
      / ____ \ (_| | (_| | | |  __/\__ \__ \ (__| | (_) | |_| | (_| |
     /_/    \_\__,_|\__,_|_|  \___||___/___/\___|_|\___/ \__,_|\__,_|
                                                                     
    Demo for https://github.com/addresscloud/terraform-aws-tile-service PMTiles.
    Our thanks to the folks at MapTiler for providing OpenMapTiler https://openmaptiles.org/ and osm-liberty style used for this non-commercial demo.                                                                                                                                  
    -->
      <meta charset="utf-8" />
      <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no"/>
      <link rel="icon" href="../common/favicon.png" type="image/png">
      <title>Tile service demo | @addresscloud</title>
      <script src="https://unpkg.com/maplibre-gl@2.1.9/dist/maplibre-gl.js"></script>
      <link href="https://unpkg.com/maplibre-gl@2.1.9/dist/maplibre-gl.css" rel="stylesheet"/>
      <script src="osm-liberty-pmtile.js"></script>
      <link href="../common/style.css" rel="stylesheet"/>
      <script src="https://unpkg.com/pmtiles@3.2.0/dist/pmtiles.js"></script>
  </head>

  <body>
    <span id="logo">
     <a href="https://github.com/addresscloud">
        <img src="https://cdn.addresscloud.com/assets/images/logos/logo-200px.png">
    </a>
    </span>
      <span id="forkongithub">
          <a href="https://github.com/addresscloud/terraform-aws-tile-service">Fork me on GitHub</a>
      </span>
      <div id="map"></div>
      <script>
        // See https://github.com/protomaps/PMTiles/blob/main/js/examples/maplibre_headers.html
        // Big thanks to @bdon (https://github.com/bdon) for making headers work.
        // Protocol for PMTiles
        let protocol = new pmtiles.Protocol();
        maplibregl.addProtocol("pmtiles", protocol.tile);
        
        // PMTiles source with headers - note PMTILES_URL must match the URL in the style file.
        let PMTILES_URL = "https://tile-demo.addresscloud.com/v1/tilefile/opmosm-pmtile/20220825/florence.pmtiles";
        let source = new pmtiles.FetchSource(PMTILES_URL, new Headers({'x-api-key': "DEMO-KEY-b91ed57f-5438-4d99-a17e-6723610f7ad9"}));
        
        // Add PMTiles source to protocol
        const p = new pmtiles.PMTiles(source);
        protocol.add(p);

          var map = new maplibregl.Map({
              attributionControl: false,
              container: 'map',
              style: style,
              center: [11.25,43.77],
              zoom: 13
          }).addControl(new maplibregl.AttributionControl({
                compact: false,
                customAttribution: 'OpenMapTiles'
            }));
      </script>
  </body>
</html>